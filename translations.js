// translations.js - Toutes les traductions

const TRANSLATIONS = {
    // Navigation
    'nav.home': { fr: 'Accueil', en: 'Home', es: 'Inicio' },
    'nav.features': { fr: 'Fonctionnalit√©s', en: 'Features', es: 'Caracter√≠sticas' },
    'nav.dpia': { fr: 'DPIA', en: 'DPIA', es: 'DPIA' },
     'nav.pricing': { fr: 'Tarifs', en: 'Pricing', es: 'Precios' },
    'nav.contact': { fr: 'Contact', en: 'Contact', es: 'Contacto' },
    'nav.dashboard': { fr: 'Mon Dashboard', en: 'My Dashboard', es: 'Mi Panel' },
    'nav.login': { fr: 'Connexion', en: 'Login', es: 'Iniciar sesi√≥n' },
    'nav.register': { fr: 'Inscription', en: 'Register', es: 'Registrarse' },
    'nav.profile': { fr: 'Profil', en: 'Profile', es: 'Perfil' },
    'nav.logout': { fr: 'D√©connexion', en: 'Logout', es: 'Cerrar sesi√≥n' },
    
    // Page d'accueil (compl√®te avec tous tes textes)
    'home.title': { fr: 'Analyseur RGPD Intelligent', en: 'Smart GDPR Analyzer', es: 'Analizador RGPD Inteligente' },
    'home.subtitle': { fr: 'Analyse automatique de vos formulaires et processus', en: 'Automatic analysis of your forms and processes', es: 'An√°lisis autom√°tico de sus formularios y procesos' },
    'home.choose_template': { fr: 'Choisissez un template', en: 'Choose a template', es: 'Elija una plantilla' },
    'home.recruitment': { fr: 'Recrutement', en: 'Recruitment', es: 'Reclutamiento' },
    'home.health': { fr: 'Sant√©', en: 'Health', es: 'Salud' },
    'home.finance': { fr: 'Finance', en: 'Finance', es: 'Finanzas' },
    'home.custom': { fr: 'Personnalis√©', en: 'Custom', es: 'Personalizado' },
    'home.paste_text': { fr: 'Collez votre texte ici...', en: 'Paste your text here...', es: 'Pegue su texto aqu√≠...' },
    'home.analyze': { fr: 'Analyser', en: 'Analyze', es: 'Analizar' },
    'home.clear': { fr: 'Effacer', en: 'Clear', es: 'Limpiar' },
    'home.analysis_results': { fr: 'R√©sultats de l\'analyse', en: 'Analysis Results', es: 'Resultados del an√°lisis' },
    'home.compliance_score': { fr: 'Score de conformit√©', en: 'Compliance Score', es: 'Puntuaci√≥n de cumplimiento' },
    'home.recommendations': { fr: 'Recommandations', en: 'Recommendations', es: 'Recomendaciones' },
    'home.risks_detected': { fr: 'Risques d√©tect√©s', en: 'Risks detected', es: 'Riesgos detectados' },
    'home.main_title': { 
    fr: 'Conformit√© AI Act & RGPD Automatis√©e', 
    en: 'Automated AI Act & GDPR Compliance', 
    es: 'Cumplimiento Automatizado AI Act & RGPD' 
},
'home.main_subtitle': { 
    fr: 'Analysez vos syst√®mes d\'IA en temps r√©el. √âvitez les amendes jusqu\'√† 7% de votre chiffre d\'affaires.', 
    en: 'Analyze your AI systems in real-time. Avoid fines up to 7% of your revenue.', 
    es: 'Analice sus sistemas de IA en tiempo real. Evite multas de hasta el 7% de sus ingresos.' 
},
'home.examples': { fr: 'Exemples Pr√©d√©finis', en: 'Predefined Examples', es: 'Ejemplos Predefinidos' },
'home.analyzer_title': { fr: 'Analyseur de Conformit√©', en: 'Compliance Analyzer', es: 'Analizador de Cumplimiento' },
'home.company_label': { fr: 'Nom de l\'entreprise', en: 'Company Name', es: 'Nombre de la empresa' },
'home.company_placeholder': { fr: 'Ex: MaStartup SAS', en: 'Ex: MyStartup LLC', es: 'Ej: MiStartup S.L.' },
'home.system_label': { fr: 'D√©crivez votre syst√®me d\'IA', en: 'Describe your AI system', es: 'Describa su sistema de IA' },
'home.text_placeholder': { fr: 'D√©crivez en d√©tail votre utilisation de l\'intelligence artificielle...', en: 'Describe in detail your use of artificial intelligence...', es: 'Describa en detalle su uso de inteligencia artificial...' },
'home.analyze_button': { fr: 'Analyser la Conformit√©', en: 'Analyze Compliance', es: 'Analizar Cumplimiento' },
'home.loading_title': { fr: 'Analyse en cours...', en: 'Analysis in progress...', es: 'An√°lisis en curso...' },
'home.loading_text': { fr: 'Notre IA examine votre texte pour identifier les risques de conformit√©', en: 'Our AI is examining your text to identify compliance risks', es: 'Nuestra IA examina su texto para identificar riesgos de cumplimiento' },
'home.report_title': { fr: 'Rapport d\'Analyse', en: 'Analysis Report', es: 'Informe de An√°lisis' },
'home.copy_button': { fr: 'Copier', en: 'Copy', es: 'Copiar' },
'home.pdf_button': { fr: 'PDF', en: 'PDF', es: 'PDF' },
'home.save_button': { fr: 'Sauvegarder', en: 'Save', es: 'Guardar' },
'home.csv_button': { fr: 'CSV', en: 'CSV', es: 'CSV' },
    // DPIA (compl√®te avec tous tes textes)
    'dpia.title': { fr: 'G√©n√©rateur de DPIA Automatis√©', en: 'Automated DPIA Generator', es: 'Generador Autom√°tico de DPIA' },
    'dpia.subtitle': { fr: 'Cr√©ez votre Analyse d\'Impact en quelques clics', en: 'Create your Impact Analysis in a few clicks', es: 'Cree su An√°lisis de Impacto en unos clics' },
    'dpia.choose_template': { fr: 'Choisissez votre secteur', en: 'Choose your sector', es: 'Elija su sector' },
    'dpia.recruitment_desc': { fr: 'Pour les processus de recrutement et RH', en: 'For recruitment and HR processes', es: 'Para procesos de reclutamiento y RRHH' },
    'dpia.health_desc': { fr: 'Pour les donn√©es m√©dicales et de sant√©', en: 'For medical and health data', es: 'Para datos m√©dicos y de salud' },
    'dpia.finance_desc': { fr: 'Pour les donn√©es financi√®res et bancaires', en: 'For financial and banking data', es: 'Para datos financieros y bancarios' },
    'dpia.start': { fr: 'Commencer', en: 'Start', es: 'Comenzar' },
    'dpia.back_choice': { fr: '‚Üê Retour au choix', en: '‚Üê Back to choice', es: '‚Üê Volver a la elecci√≥n' },
    'dpia.back_home': { fr: '‚Üê Retour √† l\'accueil', en: '‚Üê Back to home', es: '‚Üê Volver al inicio' },
    'dpia.new_dpia': { fr: '‚Üê Nouvelle DPIA', en: '‚Üê New DPIA', es: '‚Üê Nueva DPIA' },
    'dpia.generate': { fr: 'G√©n√©rer ma DPIA compl√®te', en: 'Generate my complete DPIA', es: 'Generar mi DPIA completa' },
    
    // Questions DPIA
    'dpia.q1': { fr: 'Volume de traitement mensuel ?', en: 'Monthly processing volume?', es: '¬øVolumen de procesamiento mensual?' },
    'dpia.q2': { fr: 'Type de donn√©es trait√©es ?', en: 'Type of data processed?', es: '¬øTipo de datos procesados?' },
    'dpia.q3': { fr: 'Pourcentage de d√©cision automatis√©e ?', en: 'Percentage of automated decision?', es: '¬øPorcentaje de decisi√≥n automatizada?' },
    'dpia.q4': { fr: 'Dur√©e de conservation des donn√©es ?', en: 'Data retention period?', es: '¬øPer√≠odo de retenci√≥n de datos?' },
    'dpia.q5': { fr: 'Qui a acc√®s aux donn√©es ?', en: 'Who has access to the data?', es: '¬øQui√©n tiene acceso a los datos?' },
    
    // R√©sultats DPIA
    'dpia.result.score': { fr: 'SCORE', en: 'SCORE', es: 'PUNTUACI√ìN' },
    'dpia.result.date': { fr: 'Document g√©n√©r√© le', en: 'Document generated on', es: 'Documento generado el' },
    'dpia.result.analysis': { fr: 'Analyse du score', en: 'Score analysis', es: 'An√°lisis de puntuaci√≥n' },
    'dpia.result.improvements': { fr: 'Points d\'am√©lioration', en: 'Improvement points', es: 'Puntos de mejora' },
    'dpia.result.your_answers': { fr: 'Vos r√©ponses', en: 'Your answers', es: 'Sus respuestas' },
    'dpia.result.recommendations': { fr: 'Recommandations', en: 'Recommendations', es: 'Recomendaciones' },
    'dpia.result.download_pdf': { fr: 'T√©l√©charger PDF', en: 'Download PDF', es: 'Descargar PDF' },
    'dpia.result.print': { fr: 'Imprimer', en: 'Print', es: 'Imprimir' },
    
    // Footer
    'footer.rights': { fr: 'Tous droits r√©serv√©s', en: 'All rights reserved', es: 'Todos los derechos reservados' },
    'footer.privacy': { fr: 'Politique de confidentialit√©', en: 'Privacy Policy', es: 'Pol√≠tica de privacidad' },
    'footer.terms': { fr: 'Conditions d\'utilisation', en: 'Terms of Service', es: 'T√©rminos de servicio' },
    
    // Login/Register
    'login.title': { fr: 'Connexion', en: 'Login', es: 'Iniciar sesi√≥n' },
    'register.title': { fr: 'Inscription', en: 'Register', es: 'Registrarse' },
    'login.email': { fr: 'Email', en: 'Email', es: 'Correo electr√≥nico' },
    'login.password': { fr: 'Mot de passe', en: 'Password', es: 'Contrase√±a' },
    'login.remember': { fr: 'Se souvenir de moi', en: 'Remember me', es: 'Recordarme' },
    'login.forgot': { fr: 'Mot de passe oubli√© ?', en: 'Forgot password?', es: '¬øOlvid√≥ su contrase√±a?' },
    'login.no_account': { fr: 'Pas encore de compte ?', en: 'No account yet?', es: '¬øNo tiene cuenta a√∫n?' },
    'login.has_account': { fr: 'D√©j√† un compte ?', en: 'Already have an account?', es: '¬øYa tiene una cuenta?' },
    'login.submit': { fr: 'Se connecter', en: 'Sign in', es: 'Iniciar sesi√≥n' },
    'register.submit': { fr: 'S\'inscrire', en: 'Sign up', es: 'Registrarse' }
};

// Configuration
const SUPPORTED_LANGUAGES = ['fr', 'en', 'es'];
const DEFAULT_LANGUAGE = 'fr';

// R√©cup√©rer la langue actuelle
function getCurrentLanguage() {
    return localStorage.getItem('clarity_language') || 
           navigator.language.split('-')[0] || 
           DEFAULT_LANGUAGE;
}

// Sauvegarder la langue
function saveLanguage(lang) {
    localStorage.setItem('clarity_language', lang);
}

// Fonction de traduction
function t(key, lang = null) {
    const language = lang || getCurrentLanguage();
    const translation = TRANSLATIONS[key];
    
    if (!translation) {
        console.warn(`‚ö†Ô∏è Traduction manquante: ${key}`);
        return key;
    }
    
    return translation[language] || translation[DEFAULT_LANGUAGE] || key;
}

// Changer de langue
function changeLanguage(lang) {
    if (!SUPPORTED_LANGUAGES.includes(lang)) {
        console.error(`Langue non support√©e: ${lang}`);
        return;
    }
    
    // Sauvegarder la pr√©f√©rence
    saveLanguage(lang);
    
    // Mettre √† jour l'interface
    applyTranslations(lang);
    
    // Mettre en surbrillance le bouton actif
    highlightActiveLanguage(lang);
    
    // D√©clencher un √©v√©nement personnalis√©
    const event = new CustomEvent('languageChanged', { detail: { language: lang } });
    document.dispatchEvent(event);
    
    console.log(`üåç Langue chang√©e: ${lang}`);
}

// Appliquer les traductions
function applyTranslations(lang = null) {
    const language = lang || getCurrentLanguage();
    
    console.log(`üî§ Application des traductions: ${language}`);
    
    // 1. Textes normaux
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        const translation = t(key, language);
        
        if (translation) {
            element.textContent = translation;
        }
    });
    
    // 2. Placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        const translation = t(key, language);
        
        if (translation) {
            element.placeholder = translation;
        }
    });
    
    // 3. Titres et attributs
    document.querySelectorAll('[data-i18n-title]').forEach(element => {
        const key = element.getAttribute('data-i18n-title');
        const translation = t(key, language);
        
        if (translation) {
            element.title = translation;
        }
    });
    
    // 4. Titre de la page
    document.title = t('home.title', language);
    
    // 5. Mettre √† jour les contenus dynamiques
    updateDynamicTranslations(language);
}

// Mettre √† jour les contenus dynamiques (DPIA, etc.)
function updateDynamicTranslations(lang) {
    // Informer les autres modules du changement de langue
    if (typeof updateDPIATranslations === 'function') {
        updateDPIATranslations(lang);
    }
    
    if (typeof updateAnalyzerTranslations === 'function') {
        updateAnalyzerTranslations(lang);
    }
    
    // Mettre √† jour les formulaires existants
    updateFormsTranslations(lang);
}

// Mettre √† jour les formulaires
function updateFormsTranslations(lang) {
    // DPIA forms
    const dpiaForms = document.querySelectorAll('[id^="dpia-form-"]');
    dpiaForms.forEach(form => {
        // Mettre √† jour les labels, boutons, etc.
        const labels = form.querySelectorAll('label');
        labels.forEach(label => {
            // Logique pour mettre √† jour les labels DPIA
            if (label.textContent.includes('Volume de traitement')) {
                label.textContent = t('dpia.q1', lang);
            }
            // ... autres conditions
        });
        
        // Mettre √† jour le bouton de soumission
        const submitBtn = form.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.innerHTML = `<i class="fas fa-file-contract"></i> ${t('dpia.generate', lang)}`;
        }
    });
}

// Mettre en surbrillance la langue active
function highlightActiveLanguage(lang) {
    document.querySelectorAll('.lang-btn').forEach(btn => {
        if (btn.dataset.lang === lang) {
            btn.classList.add('active');
            btn.style.fontWeight = 'bold';
            btn.style.opacity = '1';
        } else {
            btn.classList.remove('active');
            btn.style.fontWeight = 'normal';
            btn.style.opacity = '0.7';
        }
    });
}

// Initialiser le syst√®me de langue
function initLanguage() {
    const currentLang = getCurrentLanguage();
    
    console.log(`üåê Initialisation multilinguisme: ${currentLang}`);
    
 
    // Appliquer les traductions
    applyTranslations(currentLang);
    
    // Mettre en surbrillance la langue active
    highlightActiveLanguage(currentLang);
    
    // √âcouter les changements de langue
    document.addEventListener('languageChanged', (event) => {
        console.log(`Langue chang√©e vers: ${event.detail.language}`);
    });
}

// Cr√©er le s√©lecteur de langue
function createLanguageSelector() {
    console.log('‚úÖ S√©lecteur HTML d√©j√† pr√©sent - aucune cr√©ation n√©cessaire');
    return; // NE RIEN FAIRE, on a d√©j√† le s√©lecteur dans le HTML
}
// Exporter les fonctions
window.t = t;
window.changeLanguage = changeLanguage;
window.initLanguage = initLanguage;
window.getCurrentLanguage = getCurrentLanguage;